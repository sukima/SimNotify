!!!HTML4
%html
  %head
    = stylesheet_link_jquery
    = javascript_include_jquery
    :css
      div.ui-widget {
        font-size: 0.6em;
        padding: 2px;
        width: 50%;
      }
      li.week-list-item {
        margin: 5px 0px;
      }
      .facility-box {
        padding: 0px 5px;
      }
      @media print {
        #controls {
          display: none;
        }
      }
    :javascript
      $(function() {
        $("input:submit").button();
        $("#print-button").button({icons:{primary:'ui-icon-print'}});
        $("#return-button").button({icons:{primary:'ui-icon-arrowreturnthick-1-w'}});
      });
  %body
    #controls.ui-widget.ui-widget-header.ui-corner-all
      - form_tag agenda_path do
        = link_to "Return", calendar_path, :id => "return-button"
        = link_to "Print", "javascript:window.print()", :id => "print-button"
        = text_field_tag 'number_of_weeks', @number_of_weeks
        = select_tag "tech", "<option value='all'>All Technicians</option>" +                  |
          options_from_collection_for_select(Instructor.technicians, "id", "name", @tech.to_i) |
        = submit_tag "Refresh"
    %h1= "Agenda for #{@date_range}"
    %hr
    - if @weeks.empty?
      .info There are no events scheduled.
    - @weeks.each_with_index do |week,index|
      %div{:id => "week-#{index}"}
        %h2= "Week for #{week[:week_start].strftime(@time_format)} - #{week[:week_end].strftime(@time_format)}"
        - if week[:events].empty?
          .info No sessions scheduled for this week.
        - else
          %ol.week-list
            - day_match = nil
            - week[:events].each do |event|
              - event_day = event.start_time.strftime("%A - %B %d")
              - if event_day != day_match
                - day_match = event_day
                %h4= event_day
              %li.week-list-item
                = agenda_event_description_for(event)
                %span.facility-box{:style=>"background-color: #{facility_color(event)};"}
                  = facility_name(event)
